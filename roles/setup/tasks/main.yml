- name: Server Infrastructure Setup
  ansible.builtin.debug:
    msg: "Setting up server infrastructure with Ansible"


- name: copy ssh configuration
  ansible.builtin.copy:
    src: sshd_config
    dest: /etc/ssh/
    owner: root
    mode: '0644'

- name: Restart service ssh
  ansible.builtin.service:
    name: ssh
    state: restarted

- name: Set authorized key taken from file
  ansible.posix.authorized_key:
    user: root
    state: present
    key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDhDA1CnB+IiBtswe5x1pzvnuQzTeyw0Mms+bAZqeKTbUvq90+kYJZEQoUq+57zMvREpBfx+B/5pVZ4v87xPTkupvEj4ixTwvJl5Ae3yK451aPTjOR0zPWTt335gCwxSvj2sbECjcjdq6LH1GNuRFrFXekqbZPAM8l7lyuC/YkJwvHd8JmibnTpo6RlCYEMSo/tkGJT8mLWNHuJfnHcmrw9qqvxrZ1gnjqMBp0DoBb8NH/6DfDh13bxRjUuHBM4CDliRtvI9jykKULgyR5k44dq/mLjD/HRd/XgJrwiwlE79NA9kp42d3aYLNJwpe8DSRF80TtsOnGI6g4MwwXs+zxBy6mlucOLyZTV2xTn/7treuv99EQzaPKBZnNUwSeO1pEYUUjDynR5Jn9u5Fw3OW44TZy3+e6N2wsr5S+8JGfCQZpry0YwVlSQ1TqFNyxTbKmd06lA3GtSY/K+Q9kATOKZ4Eb7n2JcVV6RdLSSydSpvZeTC2wxMI4tlrrx24QpnnSHDRCi3xpRHZmMLbuhT7Xz8UDugyc67W6GavFQAT0LSxSl46H4Jgxwe784X0elvpF998uXDaK7YDM8fOVqnPT5I/SJQFGiWHAh+wNueuc/ZMJ4+T0f3qc8/HCZeNvcjaZ7v/tLxKcbcihNEDS+BD7VFKtwjIbrClxJjH0N5Khb4w== Generated By Termius"

- name: ufw allow ssh
  community.general.ufw:
    rule: allow
    name: OpenSSH

- name: start ufw
  community.general.ufw:
    state: enabled
    policy: deny


- name: Add samba share configuration to smb.conf
  blockinfile:
    path: "/etc/samba/smb.conf"
    block: |
      [Storage]
      path = /mnt/storage
      public = yes
      writeable = yes

- name: Restart Samba service
  service:
    name: smbd
    state: restarted